// @ts-nocheck
let STATE={};function togglePopup(e,t=!0){$("#"+e).toggleClass("d-none",!t)}async function sendRequest(e,t="prod"){showAjaxIndicator();let s={dev:"https://script.google.com/macros/s/AKfycbwszbYjPHiVihhwLPKW3SwBHZuGRTkG79wYgxYxxvg/dev",prod:"https://script.google.com/macros/s/AKfycbxoXngbg1GepifFTZD1TMKiBfnx_n2Q1s8ysSTxzqWmwiaZqWLXoj1dTIaf_K00-X78/exec"};try{e.password||(e.jwt=localStorage.getItem("jwt")||"");const n=await $.ajax({url:s[t],method:"POST",data:JSON.stringify(e)});return hideAjaxIndicator(),n}catch(e){throw console.error("Error:",e),hideAjaxIndicator(),e}}function setupSidebar(){if($("#main-container").length||$("body").prepend('\n      <div id="main-container" class="d-flex mw-100">\n        <div id="sidebar-container" class="d-flex" style="position: fixed; left: 0; top: 0; height: 100vh; z-index: 1000;">\n          \x3c!-- Sidebar --\x3e\n          <nav class="sidebar d-flex flex-column flex-shrink-0 p-2 text-white bg-dark sidebar-expanded" id="sidebar">\n            <div class="logo mb-3">\n              <img src="https://via.placeholder.com/40" class="rounded-circle" alt="Logo">\n            </div>\n            <ul class="nav nav-pills flex-column mb-auto">\n              <li><a href="#customers" class="nav-link text-white"><i class="bi bi-person"></i> <span class="sidebar-text">Khách hàng</span></a></li>\n              <li><a href="#suppliers" class="nav-link text-white"><i class="bi bi-truck"></i> <span class="sidebar-text">Nhà cung cấp</span></a></li>\n              <li><a href="#products" class="nav-link text-white"><i class="bi bi-box"></i> <span class="sidebar-text">Sản phẩm</span></a></li>\n              <li><a href="#shipping" class="nav-link text-white"><i class="bi bi-geo-alt"></i> <span class="sidebar-text">Đơn vị vận chuyển</span></a></li>\n              <li><a href="#support" class="nav-link text-white"><i class="bi bi-chat-dots"></i> <span class="sidebar-text">CSKH - Báo giá</span></a></li>\n              <li><a href="#orders" class="nav-link text-white"><i class="bi bi-receipt"></i> <span class="sidebar-text">Đơn hàng</span></a></li>\n            </ul>\n            <div class="bottom mt-auto d-flex flex-column align-items-center">\n              <img src="https://via.placeholder.com/40" class="rounded-circle mb-2 avatar" alt="Avatar">\n              <button class="btn btn-outline-light btn-sm logout-btn" onclick="doLogout()"><i class="bi bi-box-arrow-right"></i> <span class="logout-text">Logout</span></button>\n            </div>\n          </nav>\n        </div>\n      </div>\n    '),$("#sidebarCollapse").length||$("#main-container").prepend('<button id="sidebarCollapse" class="btn btn-primary d-md-none" style="position:fixed; top:10px; left:10px; z-index:1100;"><i class="bi bi-list"></i></button>'),$("#sidebar .nav-link").on("click",(function(e){e.preventDefault();const t=$(this).find(".sidebar-text").text().trim().toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,"");setActivePage.call(this,t)})),$("#sidebarCollapse").off("click").on("click",(function(){window.matchMedia("(max-width: 768px)").matches?$("#sidebar").toggleClass("d-none"):($("#sidebar").toggleClass("sidebar-collapsed sidebar-expanded"),$("#sidebar-container").toggleClass("sidebar-collapsed sidebar-expanded"))})),"ontouchstart"in window||($("#sidebar").addClass("sidebar-collapsed").removeClass("sidebar-expanded"),$("#sidebar").hover((function(){$(this).removeClass("sidebar-collapsed").addClass("sidebar-expanded")}),(function(){$(this).removeClass("sidebar-expanded").addClass("sidebar-collapsed")}))),window.doLogout=function(){localStorage.removeItem("jwt"),localStorage.removeItem("savedUsername"),location.reload()},!$("#app").length){const e=$("#sidebar").length?$("#sidebar").outerWidth():250;$("#main-container").append(`<div id="app" style="margin-left: ${e}px; width: calc(100% - ${e}px);"></div>`)}$("#sidebar .nav-link")[0].click()}function saveUsername(e){const t=$("#Username");$("#remember-me").prop("checked")?(localStorage.setItem("savedUsername",t.val()),localStorage.setItem("jwt",e)):(localStorage.removeItem("savedUsername"),localStorage.removeItem("jwt"))}function loadScriptsAfterLogin(e){const t=e.map((e=>$.getScript(e)));return Promise.all(t)}function loadApp(){hideLoading(),loadScriptsAfterLogin(["/src/customers.js","/src/utility.js"]).then((()=>{$(".login-box").hide(),$("body").removeClass("vh-100 justify-content-center align-items-center").addClass("align-items-start pt-3"),setupSidebar()}))}function unloadApp(){hideLoading(),$(".login-box").show(),$("body").removeClass("align-items-start pt-3").addClass("vh-100 justify-content-center align-items-center"),$("#app").empty(),$("#sidebar-container").remove()}function loadUsername(){const e=localStorage.getItem("savedUsername"),t=localStorage.getItem("jwt");if(t)return showLoading("Đang tự động đăng nhập..."),e&&($("#Username").val(e),$("#remember-me").prop("checked",!0)),sendRequest({action:"login",jwt:t}).then((e=>{e&&e.success?(loadApp(),STATE.customerSheetData=e.customerData,STATE.customerSheetConfig=e.customerConfig):unloadApp()}));unloadApp()}function showLoading(e="Đang tải..."){$("#loading-overlay").length?$("#loading-text").text(e):$("body").append(`\n      <div id="loading-overlay" class="d-flex justify-content-center align-items-center position-fixed w-100 h-100" style="top:0; left:0; background-color: rgba(0,0,0,0.5); z-index: 9999; display: none;">\n        <div class="text-center text-white">\n          <div class="spinner-border" role="status">\n            <span class="visually-hidden">Loading...</span>\n          </div>\n          <div id="loading-text" class="mt-2">${e}</div>\n        </div>\n      </div>\n    `),$("#loading-overlay").toggleClass("d-none",!1)}function showAjaxIndicator(){$("#ajax-indicator").show()}function hideAjaxIndicator(){$("#ajax-indicator").hide()}function setActivePage(){$("#sidebar .nav-link").removeClass("active");let e=$(this).attr("href").replace("#","");if($(this).addClass("active"),console.log("Active page:",e),STATE.activePage={key:e,label:$(this).find(".sidebar-text").text().trim()},"customers"===e)setupCustomers();else $("#app").html("<h1>Quà tặng Phương Trinh</h1>")}function doLogin(){const e=$("#Username").val().trim(),t=$("#Password").val().trim();e&&t?sendRequest({action:"login",username:e,password:t}).then((e=>{e.success?(console.log(e.jwt),saveUsername(e.jwt),e.firstLogin?showChangePasswordPopup():loadApp()):swal.fire({title:"Thông báo",text:"Sai Username hoặc Password, vui lòng thử lại!",icon:"warning"})})):swal.fire({title:"Thông báo",text:"Vui lòng nhập đầy đủ Username và Password!",icon:"warning"})}function showChangePasswordPopup(){togglePopup("change-password-popup")}function hideChangePasswordPopup(){togglePopup("change-password-popup",!1)}function doChangePassword(e){e.preventDefault();const t=$("#new-password").val().trim(),s=$("#confirm-password").val().trim(),n=$("#Username").val().trim();t===s?sendRequest({action:"changePassword",uid:n,newPass:t}).then((e=>{e.success?(hideChangePasswordPopup(),$("#Password, #new-password, #confirm-password").val(""),swal.fire("Thông báo","Đổi mật khẩu thành công","success")):swal.fire("Thông báo","Có lỗi khi đổi mật khẩu, vui lòng thử lại!","error")})):swal.fire({title:"Thông báo",text:"Mật khẩu xác nhận không khớp!",icon:"warning"})}function showForgotPasswordPopup(){togglePopup("forgot-password-popup")}function hideForgotPasswordPopup(){togglePopup("forgot-password-popup",!1)}function doForgotPassword(e){e.preventDefault();const t=$("#emailOrUid-ResetPassword").val().trim();t?sendRequest({action:"forgotPassword",emailOrUid:t}).then((e=>{e.success?(swal.fire("Thông báo","Yêu cầu đã được gửi. Vui lòng kiểm tra email hoặc liên hệ Admin!","success"),hideForgotPasswordPopup()):swal.fire("Thông báo","Không tìm thấy tài khoản hoặc email!","warning")})):swal.fire("Thông báo","Vui lòng nhập Username hoặc Email!","warning")}function togglePassword(e,t){const s=$("#"+e);if(!s.length)return;const n=$(t).find(".material-icons");"password"===s.attr("type")?(s.attr("type","text"),n.text("visibility_off")):(s.attr("type","password"),n.text("visibility")),s.focus()}$("#ajax-indicator").length||$("body").prepend('<div id="ajax-indicator" class="bg-success" style="height: 4px; width: 100%; position: fixed; top: 0; left: 0; z-index: 10000; display: none;"></div>'),$(document).ready((function(){["change-password-popup","forgot-password-popup"].forEach((e=>{togglePopup(e,!1),console.log("run toggle")})),$(".forgot-link").on("click",(function(e){e.preventDefault(),console.log("clicked forgot"),togglePopup("forgot-password-popup")})),$("#loginBtn").on("click",(function(){doLogin()})),loadUsername()})),$(document).on("keydown",(function(e){if("Enter"!==e.key)return;const t=$(document.activeElement);e.preventDefault();const s=t.closest("form, .popup, .login-box").find("button[data-default], button[type='submit'], button, input[type='submit']").first();s.length&&s.click()}));